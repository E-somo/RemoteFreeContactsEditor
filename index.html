<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Login Form</title>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <style>
        body {
            background-color: #15b337;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            margin: 0;
        }

        .main-container {
            background-color: #15b337;
            width: 65%;
            margin: 0 auto;
            text-align: center;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.3);
        }

        .button-container {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 10px;
            padding: 20px;
        }

        .styled-button {
            padding: 10px 20px;
            background-color: #3498db;
            color: white;
            border: none;
            border-radius: 5px;
            height: fit-content;
            cursor: pointer;
            transition: background-color 0.3s ease;
        }

        .styled-button:hover {
            background-color: #2980b9;
        }
    </style>
</head>
<body>
    <div class="main-container">
        <h2 style="text-align:center;">
    <h2><big>Bulky SMS </big> <br> <br> Remote Free Bulky SMS contact Editor and SMS Customization <br> <br>

Dashboard 
</h2>
        <div class="button-container">
            <button class="styled-button" onclick="showVideoAlert() "> How to use Remote SMS <br><br>Customization Dashboard</button>
            <button class="styled-button" onclick="showImageAlert()">Remotely Add/Edit  <br> <br> contacts For Group Message</button>
            <button class="styled-button" onclick="showGoogleSheetAlert()"> Remotely customize   <br> <br>Indidualized Bulky SMS  </button>
        </div>
        <button onclick="showLoginModal()">Login as A client Instead ??? </button>
    </div>


    <script>
    var field1 = "not";
    var field2 = "not";
    var field3 = "not";
    var fieldSerch="get"; 
    var fieldcore ="nen";

    showLoginModal();
    
function showImageAlert() {
    Swal.fire({
        title: 'Suitable for Group Message',
        html: `
            <p>
               For Those who uses SBMA :  To send a common message to all your prepared and updated group, send a normal SMS to your updated server with the following command:<br>
                <br>
                <b>CMD7bulk:</b> followed by the message to send.<br>
                Example: CMDbulk: dear Parent/staff, The meeting is shifted to Tuesday 9:00. Thanks.<br>
                <br> <p>  For Those Who use <b> Bulky SMS sender App </b> </p> <br>  After  linking your sheet to the App follow simple steps in the App to sent sms to all contact just updated in your SMS sender App.  <br> 
                N.B: <br> The total message characters should <b> not exceed 160.</b><br>
                <br>
                If you  want to see the sample google sheet contact, click <a href="javascript:void(0);" onclick="showSamplePicture()">here</a> <br> <br>To login to your contact , set up  or updating contact <b>click Ok.<br>
            </p>`,
        confirmButtonText: 'OK',
        didClose: () => {
            openForm();
        }
    });
}

function showSamplePicture() {
    Swal.fire({
        text: 'N.B Remember, in Column B, input full names, and in Column C, provide the corresponding contact phone numbers. Failure to adhere to this format may result in the functionality not working correctly.',
        imageUrl: 'https://raw.githubusercontent.com/E-somo/Remote_control/main/contactsview.PNG',
        imageAlt: 'Sample Picture',
        confirmButtonText: 'OK'
    });
}

function showSamplePicture2() {
    Swal.fire({
        text: 'N.B Remember, in Column B, input full Message contents, and in Column C, provide the message receiver contact phone numbers. Failure to adhere to this format may result in the functionality not working correctly.',
        imageUrl: 'https://raw.githubusercontent.com/E-somo/Remote_control/main/graduation.PNG',
        imageAlt: 'Sample Picture',
        confirmButtonText: 'OK'
    });
}


function showVideoAlert() {
    // Create a custom HTML element for the video
    const videoElement = document.createElement("div");
    videoElement.innerHTML = `
        <video width="560" height="315" controls>
            <source src="https://github.com/E-somo/downloads/raw/main/New%20creative%20video.mp4" type="video/mp4">
            Your browser does not support the video tag.
        </video>
        <p> The video  serves ara desctiprion of ho</p>
    `;

    // Show the Swal modal with the custom HTML
    Swal.fire({
        title: 'Video Tutorial How To',
        html: videoElement,
        confirmButtonText: 'OK',
        showCloseButton: true, 
    });
}

        function showGoogleSheetAlert() {
           Swal.fire({
        title: 'Suitable for Mutliple custom Messages',
        html: `
           
<p>
    <b> For Those who uses : SBMA </b>   To broadcast multiple customized messages to your prepared and updated recipients list, send a standard SMS to your updated server using the following command:<br>
    <br>
    <b>CMD8multisms:</b> All corresponding messages will be sent to the respective recipients.<br>
    Example: CMD8multisms: .<br>
    <br>  <b> For those who use SMS sender App</b> After making changes to your contacts and custom messages in the spreadsheet, kindly proceed to your Android app to ensure these updates are reflected. Once verified, you can initiate the sending process directly from the app. <br>
    <b>N.B:</b> Ensure that the total character count of each message from the SMS column <b>does not exceed 160.</b><br>
    <br>

              If you  want to see the sample google sheet contact, click <a href="javascript:void(0);" onclick="showSamplePicture2()">here</a> <br> <br>To login to your contact&SMS , set up  or updating contact and coresponding SMS <b>click Ok.<br>
            </p>`,
        confirmButtonText: 'OK',
        didClose: () => {
            openForm2();
        }
    });
        } 
        
        
         function openForm() {
    Swal.fire({
        title: 'Enter Your desired login data',
        html:
            ' <p> Enter your Email in the field below </p> <input id="field1" class="swal2-input" placeholder="Your Email  ">' +
            '<br> Enter Any 7-number PIN You must remember this  <input id="field2" type="password" class="swal2-input" placeholder="Your PIN here ">' +
            '<p> If you are Human, write the answer to the following equation: 0.25 + 0.25 + 0.25 + 0.25 + 50000 = ?   <input id="field3" class="swal2-input" placeholder="Enter Answer here ">  </p>' +
            '<p> <b>N.B.</b> This form is designed for updating contacts for <b>sending bulk messages via the Android App or SBMA</b>. If you intend to send the same message to multiple contacts simultaneously, please proceed.</p>',
        focusConfirm: false,
        showCancelButton: true,
        confirmButtonText: 'Submit',
        preConfirm: () => {
           field1 = Swal.getPopup().querySelector('#field1').value;
            field2 = Swal.getPopup().querySelector('#field2').value;
             field3 = Swal.getPopup().querySelector('#field3').value;

            if (field1.length > 6 && field1.includes("@") && !isNaN(field2) && field2.length === 7 && field3 === "50001") {
                const fieldSearch = field1 + field2 + field3;
                checkUpdate(fieldSearch);
            } else {
                Swal.showValidationMessage('Please provide valid login data. your Pin must a Number and your answer must be correct');
                return false;
            }
        }
    });
}   
        
    function openForm2() {
          Swal.fire({
        title: 'Enter Your SBMA Credentials',
        html:
        ' <p> Enter your Email in the field below </p> <input id="field1" class="swal2-input" placeholder="Your Email  ">' +
        '<br> Enter Any 7-number PIN You must remember this  <input id="field2" type="password" class="swal2-input" placeholder="Your PIN here ">' +
        '<p> If you are Human, write the answer to the following equation: 0.25 + 0.25 + 0.25 + 0.25 + 50000 = ?   <input id="field3" class="swal2-input" placeholder="Enter Answer here ">  </p>' +
        '<p> <b>N.B.</b> This form is for sending multi-individualized SMS. Continue if you want to send a custom message to each contact.</p>',
        focusConfirm: false,
        showCancelButton: true,
        confirmButtonText: 'Submit',
        preConfirm: () => {
             field1 = Swal.getPopup().querySelector('#field1').value;
             field2 = Swal.getPopup().querySelector('#field2').value;
             field3 = Swal.getPopup().querySelector('#field3').value;

            if (field1.length > 6 && field1.includes("@") && !isNaN(field2) && field2.length === 7 && field3 === "50001") {
                fieldSearch = field1 + field2 + field3;
                checkUpdate2(fieldSearch);
            } else {
                Swal.showValidationMessage('Please provide valid login data. your Pin must a Number and your answer must be correct');
                return false;
            }
        }
    });
}
        
    
       function reportTask(field1, field2, field3) {
            fetch('https://docs.google.com/forms/d/1yZpTspU-8xo14iueaVfixaIyGlZKxS5jostXVay0tMA/formResponse', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/x-www-form-urlencoded',
                },
                body: 'entry.1204219384=' + encodeURIComponent(field1) +
                        '&entry.1167664038=' + encodeURIComponent(field2) +
                        '&entry.1234567890=' + encodeURIComponent(field3),
            })
            .then(response => {
                console.log(response);
                Swal.fire({
                    icon: 'success',
                    title: 'Data Submitted Successfully!',
                });
            })
            .catch(error => {
                console.error('Error:', error);
            });
        }
        
        
         function reportTask2(field1, field2, field3) {
          //  fetch('https://docs.google.com/forms/d/1WGl_fce_0s_yMuaOkEeXPviHF-ZYJioVT-HQUxl734c/formResponse', {
            fetch('https://docs.google.com/forms/d/1yZpTspU-8xo14iueaVfixaIyGlZKxS5jostXVay0tMA/formResponse', {
           
                method: 'POST',
                headers: {
                    'Content-Type': 'application/x-www-form-urlencoded',
                },
                body: 'entry.1204219384=' + encodeURIComponent(field1) +
                        '&entry.1167664038=' + encodeURIComponent(field2) +
                        '&entry.1234567890=' + encodeURIComponent(field3),
            })
            .then(response => {
                console.log(response);
                Swal.fire({
                    icon: 'success',
                    title: 'Data Submitted Successfully!',
                });
            })
            .catch(error => {
                console.error('Error:', error);
            });
        }
        
       
      function checkUpdate() { 
        startLoading();
    const base = "https://docs.google.com/spreadsheets/d/11OHe5oM4mX3lDDO1k7BgFGFZbwxRWIMVyw-cOoshCHU/gviz/tq?gid=2063468632";
    const query = "Select B, C, D";
    const url = base + "&tq=" + encodeURIComponent(query);

    fetch(url)
        .then(response => response.text())
        .then(data => {
            const jsonResponse = JSON.parse(data.match(/(?<=\()[\s\S]*(?=\);)/)[0]);
            handleResponse(jsonResponse);
        })
        .catch(error => {
            console.error(error);
            displayResult("Error fetching data");
        });
}

function handleResponse(response) { 
    dismissLoading();
    if (response.status === "ok") {
        const rows = response.table.rows;
        const columnBValues = rows.map(row => row.c[0] ? row.c[0].v : null);

       // const targetValue = "examplexxcField";
       fieldSerch =field1+field2;
                  const targetValue =fieldSerch+"normal";
        const rowIndex = columnBValues.findIndex(value => value && value.includes(targetValue));

        if (rowIndex !== -1) {
            const rowData = rows[rowIndex].c.map(cell => cell ? cell.v : null);
            const alertMessage = `${rows[rowIndex].c[0].v}`;
			//alert(alertMessage);

            // Extract sheet ID and GID from the alertMessage
            const pattern = /\/spreadsheets\/d\/(.*?)\/edit#gid=(\d+)/;
			
			const pattern2 = /\?resourcekey#/;
const modifiedMessage = alertMessage.replace(pattern2, '#');
const match = modifiedMessage.match(pattern);
			
			
           
            const sheetId = match && match[1] ? match[1] : null;
            const gid = match && match[2] ? match[2] : null;

            if (sheetId !== null && gid !== null) {
                const fullSheetUrl = `https://docs.google.com/spreadsheets/d/${sheetId}/edit#gid=${gid}`;
              ///  console.log("Full Google Sheet URL: " + fullSheetUrl);

                const shift = 3;

                const inputData =fullSheetUrl;
                const encryptedData = caesarCipherEncrypt(inputData, shift);

     Swal.fire({
    title: 'Google Sheet URL',
    html: `Your  end to end encrypted link is :<br><br>${encryptedData}<br><br> Please click on the button below to see the details of your data. <br> Note: Your data is private, and only accessible to those with whom you share the link. <br> Please ensure the security of your link to safeguard your information. `,
    showCancelButton: true,
    confirmButtonText: 'Open Sheet',
    cancelButtonText: 'Close',
}).then((result) => {
    if (result.isConfirmed) {
        
        window.open(fullSheetUrl.replace("0pPsTsRymYLg12KKSvE", ""), '_blank');
    }
});

            } else {
              Swal.fire({
    icon: 'error',
    title: 'Invalid Google Sheet URL',
    text: 'You have submitted an incorrect Google Sheet URL. Please resubmit the correct URL and try again. If the error persists, please contact your service provider..',
}).then((result) => {
    if (result.isConfirmed) {
        // Handle the case where the Google Sheet URL is invalid
    } else {
        // Handle the case where the user cancels or closes the alert
    }
}).then(() => {
    Swal.fire({
        title: 'Add Contact Link',
        text: "You don't have a link to your contact. Please add it below:",
        input: 'text',
        showCancelButton: true,
        confirmButtonText: 'Submit',
        cancelButtonText: 'Cancel',
    }).then((result) => {
        if (result.isConfirmed && result.value) {
            const contactLink = result.value;

            let originalString =  "0pPsTsRymYLg12KKSvE";  
  
  let secondString = contactLink;

  let middlePosition = Math.floor(secondString.length / 2);

  let resultString = secondString.slice(0, middlePosition) + originalString + secondString.slice(middlePosition);
  fieldSerch =field1+field2;

           fieldcore = fieldSerch + "normal" +resultString ;
            reportTask(fieldcore, field1, field2);
            startLoading();
            
        } else {
            // Handle the case where the user cancels or closes the alert
        }
    });
});
        }
        } else {
           // alert(`Column B does not contain '${targetValue}'`);
            // Replace the following lines with the actual values or logic
             
            
			Swal.fire({
    title: 'Add Contact Link',
    text: "You don't have a link to your contact. Please add it below:",
    input: 'text',
    showCancelButton: true,
    confirmButtonText: 'Submit',
    cancelButtonText: 'Cancel',
}).then((result) => {
    if (result.isConfirmed && result.value) {
        const contactLink = result.value;

        
        let originalString =  "0pPsTsRymYLg12KKSvE";  
  
  let secondString = contactLink;

  let middlePosition = Math.floor(secondString.length / 2);

  let resultString = secondString.slice(0, middlePosition) + originalString + secondString.slice(middlePosition);



  fieldSerch =field1+field2;

        
         fieldcore = fieldSerch+ "normal" + resultString;
         reportTask(fieldcore, field1, field2);
         startLoading();
         
 Swal.fire({
    position: 'top-end',
    icon: 'success',
    title: 'Your work has been saved',
    showConfirmButton: false,
    timer: 1500,
    timerProgressBar: true,
    didClose: () => {
        // Callback function to be executed when the timer completes
        checkUpdate();
    }
});



    }
});	
			
        }
    } else {
        // displayResult("Error in response");
    }
}


  function checkUpdate2() {
   // const base = "https://docs.google.com/spreadsheets/d/1Ubls41BXJrucx-Ssru6LIa-5FUHps3c5Juk2QG09q38/gviz/tq?gid=1821970000";
   const base = "https://docs.google.com/spreadsheets/d/11OHe5oM4mX3lDDO1k7BgFGFZbwxRWIMVyw-cOoshCHU/gviz/tq?gid=2063468632";
   const query = "Select B, C, D";
    const url = base + "&tq=" + encodeURIComponent(query);

    fetch(url)
        .then(response => response.text())
        .then(data => {
            const jsonResponse = JSON.parse(data.match(/(?<=\()[\s\S]*(?=\);)/)[0]);
            handleResponse2(jsonResponse);
        })
        .catch(error => {
            console.error(error);
            displayResult("Error fetching data");
        });
}

function handleResponse2(response) { 

    dismissLoading();
    if (response.status === "ok") {
        const rows = response.table.rows;
        const columnBValues = rows.map(row => row.c[0] ? row.c[0].v : null);

       // const targetValue = "examplexxcField";
       fieldSerch =field1+field2;
                  const targetValue =fieldSerch+"custo";
        const rowIndex = columnBValues.findIndex(value => value && value.includes(targetValue));

        if (rowIndex !== -1) {
            const rowData = rows[rowIndex].c.map(cell => cell ? cell.v : null);
            const alertMessage = `${rows[rowIndex].c[0].v}`;
			//alert(alertMessage);

            // Extract sheet ID and GID from the alertMessage
            const pattern = /\/spreadsheets\/d\/(.*?)\/edit#gid=(\d+)/;
			
			const pattern2 = /\?resourcekey#/;
const modifiedMessage = alertMessage.replace(pattern2, '#');
const match = modifiedMessage.match(pattern);
			
			
           
            const sheetId = match && match[1] ? match[1] : null;
            const gid = match && match[2] ? match[2] : null;

            if (sheetId !== null && gid !== null) {
                const fullSheetUrl = `https://docs.google.com/spreadsheets/d/${sheetId}/edit#gid=${gid}`;
                console.log("Full Google Sheet URL: " + fullSheetUrl);
 
                const shift = 3;
                const inputData =fullSheetUrl;
                const encryptedData = caesarCipherEncrypt(inputData, shift);


     Swal.fire({
    title: ' Your Google Sheet URL',
    html: `Your retrieved link is:<br><br>${encryptedData}<br><br>Please click on the button below to see the details of your data. To edit data you need to open the link while signed in with your account `,
    showCancelButton: true,
    confirmButtonText: 'Open Sheet',
    cancelButtonText: 'Close',
}).then((result) => {
    if (result.isConfirmed) {
        
        window.open(fullSheetUrl.replace("0pPsTsRymYLg12KKSvE", ""), '_blank');
    }
});

            } else {
              Swal.fire({
    icon: 'error',
    title: 'Invalid Google Sheet URL',
    text: 'You have submitted an incorrect Google Sheet URL. Please resubmit the correct URL and try again. If the error persists, please contact your service provider..',
}).then((result) => {
    if (result.isConfirmed) {
        // Handle the case where the Google Sheet URL is invalid
    } else {
        // Handle the case where the user cancels or closes the alert
    }
}).then(() => {
    Swal.fire({
        title: 'Add Contact Link',
        text: "You don't have a link to your contact. Please add it below:",
        input: 'text',
        showCancelButton: true,
        confirmButtonText: 'Submit',
        cancelButtonText: 'Cancel',
    }).then((result) => {
        if (result.isConfirmed && result.value) {
            const contactLink = result.value;


            let originalString =  "0pPsTsRymYLg12KKSvE";  
  
  let secondString = contactLink;

  let middlePosition = Math.floor(secondString.length / 2);

  let resultString = secondString.slice(0, middlePosition) + originalString + secondString.slice(middlePosition);

  fieldSerch =field1+field2;

         fieldcore = fieldSerch + "custo" + resultString;
            reportTask2(fieldcore, field1, field2);
            startLoading();
        } else {
            // Handle the case where the user cancels or closes the alert
        }
    });
});
        }
        } else {
          //  alert(`Column B opt2 does not contain '${targetValue}'`);
            // Replace the following lines with the actual values or logic
             
            
			Swal.fire({
    title: 'Add Contact Link',
    text: "You don't have a link to your contact. Please add it below:",
    input: 'text',
    showCancelButton: true,
    confirmButtonText: 'Submit',
    cancelButtonText: 'Cancel',
}).then((result) => {
    if (result.isConfirmed && result.value) {
        const contactLink = result.value;

        // You can replace these fields with your actual values or logic

        let originalString =  "0pPsTsRymYLg12KKSvE";  
  
  let secondString = contactLink;

  let middlePosition = Math.floor(secondString.length / 2);

  let resultString = secondString.slice(0, middlePosition) + originalString + secondString.slice(middlePosition);
  
  fieldSerch =field1+field2;
        
        fieldcore = fieldSerch+ "custo" + resultString;
         reportTask2(fieldcore, field1, field2);
         startLoading();
         
 Swal.fire({
    position: 'top-end',
    icon: 'success',
    title: 'Your work has been saved',
    showConfirmButton: false,
    timer: 1500,
    timerProgressBar: true,
    didClose: () => {
        // Callback function to be executed when the timer completes
        checkUpdate2();
    }
});



    }
});	
			
        }
    } else {
        // displayResult("Error in response");
    }
}


function caesarCipherEncrypt(input, shift) {
            return input.split('').map(char => {
                if (char.match(/[a-zA-Z0-9]/)) {
                    const code = char.charCodeAt(0);
                    const isUpperCase = code >= 65 && code <= 90;
                    const offset = isUpperCase ? 65 : 97;

                    return String.fromCharCode((code - offset + shift) % 26 + offset);
                }
                return char;
            }).join('');
        }


        function startLoading() {
        // Show loading spinner
        Swal.fire({
            title: 'Please wait..... ',
            html: 'If your link is not submitted within 5 seconds, please click OK to start over and remember to paste the correct link',
            allowOutsideClick: true,
            onBeforeOpen: () => {
                Swal.showLoading();
            }
        });

        // Simulate an asynchronous operation (replace this with your actual logic)
         // Replace 2000 with the time your operation takes in milliseconds
    }

    function dismissLoading() {
        // Dismiss loading spinner
        Swal.close();
    }



    


    function openLink() {
            window.location.href = "https://e-somo.github.io/Remote_control/";
        }

        function showLoginModal() {
            Swal.fire({
                title: 'Login Method',
                text: 'This form is for Free acess . If you are a  client, please choose an option For clients : ',
                showCancelButton: true,
                confirmButtonText: 'I am a client',
                cancelButtonText: 'Free Access'
            }).then((result) => {
                if (result.isConfirmed) {
                  
                    openLink();
                } else if (result.dismiss === Swal.DismissReason.cancel) {
                    // Handle "Free Access" button click
                   
                }
            });
        }

          
    </script>

</body>
</html>
